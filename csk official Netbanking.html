<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSK KHALSA</title>
    <style>
       
    
        .upload-box {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
        }
       
       
 
 body {
 
    transition: background-image 0.5s ease-in-out;
    margin: 0;
    padding: 0;
   font-family: 'Nunito', sans-serif;
  }

   .container, .footer, .menu-container {
    
    
    
    border-radius: 10px;
    box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
    padding: 15px;
    margin: 20px;
  }
 
    button {
      padding: 10px 20px;
      background-color: black;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .result {
      background: #e6ffe6;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
    }   
       
       
       .footer {
    background-color: #f1f1f1;
    text-align: center;
    font-weight: bold;
    padding: 10px;
    border-top: 3px solid #004aad;
  }

       
       
       
       
       
       
       
       
       
       
       
       
       
         .container {
      
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
      max-width: 1000px;
      margin: auto;
    }
       
       
       
       
           
         .ss {
      background-color: yellow;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
      max-width: 1000px;
      margin: auto;
    }
       
       
       
       
       
       .codes    {
           
           border: 2px solid black;
            border-radius: 4px;
            outline: none;
            padding: 4px;
            color: black;
            
       }
       
       
          .cods    {
           
           border: 2px solid black;
            border-radius: 7px;
            outline: none;
            padding: 8px;
            color: black;
            
       }   
       
        .sub {
            color: white;
            background: blue;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            border-radius: 15px;
        }
        .sub:hover {
            background-color: darkgreen;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        td {
            color: black;
            font-weight: bold;
        }
     
     

     
     
     
        .code {
            border: 2px solid black;
            border-radius: 5px;
            outline: none;
            padding: 5px;
            color: black;
        }
        
            .pass {
            border: 3px solid black;
            border-radius: 7px;
            outline: none;
            padding: 8px;
            color: black;
        }
        
        .code:focus {
            border: 2px solid blue;
        }
        .pass:focus {
            border: 3px solid red;
        }
        
        
        
      .menu-container {
      
      background-color: white;
    position: relative;
    text-align: right;
  }

  .dots {
    font-size: 24px;
    cursor: pointer;
  }
  
.menu-options {

background-color: white;
  display: none;
  position: absolute;
  right: 0;
  top: 30px;
  background color: white;
  border: 1px solid #ccc;
  width: 160px;
  box-shadow: 0px 4px 8px rgba(0,0,0,0.1);
  z-index: 999;
  color: black;
  text-align: left;
  
}

.menu-options div {
  padding: 10px;
  cursor: pointer;
  border-bottom: 1px solid #eee;
}

.menu-options div:hover {
  background-color: #f2f2f2;
  
  font-weight: bold;
}   
           
        
      
        .spinner {
  border: 8px solid #f3f3f3;
  border-top: 8px solid blue;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  animation: spin 1s linear infinite;
  margin: auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.logo-header {
  background: linear-gradient(90deg, #004aad, #0096c7);
  color: white;
  padding: 10px ;
  font-family: 'Segoe UI', sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  margin-bottom: 15px;
}

.logo-icon {
  background: yellow;
  color: black;
  padding: 8px 12px;
  font-weight: bold;
  font-size: 15px;
  border-radius: 50%;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}

.logo-text {
  font-size: 18px;
  font-weight: bold;
  letter-spacing: 1px;
}

  
    </style>
</head>
<body text="blue">
    
<marquee bgcolor="red" scrolldelay="1" scrollamount="1">
    <font color="yellow"><b>ONLY FOR ADMIN PURPOSE USING SATURDAY AND SUNDAY AFFI. TO JASKARAN SINGH DEOL</b></font>
</marquee>
<br>

<div class="footer">
    CSK many facilities with online data websites work. students, school, accounts, all data saved
</div>




<div class="menu-container">
  <div class="dots" onclick="toggleMenu()">⋮</div>
  <div id="menuOptions" class="menu-options">
      
    <div onclick="showNewStudentForm()">Create New A/c</div>
    
  
    
    <div onclick="transferACM()">Transfer(NEFT)</div>
    
    <div onclick="Application()">Application</div> 
   
    <div onclick="transactionSearchWithId()">Transaction Status</div>
    
    <div onclick="ASTATUS()">Application Status</div>    
    
    <div onclick="knowyourAC()">Know your A/c with Adhaar</div>
    
    <div onclick="alert('Registration : 40/-  \n Application : 20/-  \n Transfer : 0/- \n Mini Bal limit for non UPI A/C: 200/-  \n Mini Bal Limit for UPI A/C : 500/-')">Charges</div>
    
  <div onclick="REGEX()">Registration</div> 

 <div onclick="find()">Find Registration</div> 
   <div onclick="cutSmsAlertChargesForAll()">SMS Charges</div>  
     
 <div onclick="cutMiniBalForAll()">Mini Bal Charge </div>
 
 <div onclick="statement()">Print Statement </div>
 
 
<div onclick="creditInterestToAll()">Credit Interest</div>
        
    <div onclick="resetPassword()">Reset Password</div>
  
    <div onclick="back()">Style Background</div>
    
 
  
    
  </div>
</div>

<div class="container">
    
    
 <div class="logo-header">
  <span class="logo-icon">CSK</span>
  <span class="logo-text">A/C CODE SERVICES</span>
</div>
    
<h5><font color="black"> *only for existing A/c holders or users.</font></h5>

<div id="transactionSearchWithIdd" style="display:none;">
    <!-- SEARCH TRANSACTION ID -->



    <form id="studentForm">
        <input type="hidden" id="editingRowIndex">
<h3>Search Transaction by ID</h3>
<input type="text" class="cods" id="searchTransactionId" placeholder="Enter Transaction ID" />
<button onclick="searchTransactionById()">Search</button>
<div id="transactionStatusResult"></div>
<br>

</div>


       
     <div id="newStudentFormContainer" style="display:none;">
    <!-- START OF NEW STUDENT FORM -->
    <center><b><h2><font color= black>New Student A/c</font></h2></b></center>
    
    <!-- All your form fields like CREATE CODE, DATE, BALANCE, etc. -->
    <!-- ... keep as is ... -->
      
      
      
        <label for="newCode"><b>CREATE NEW CODE:</b></label>
        <input type="number" id="newCode" class="code"> 
        <input type="button" value="Add Data" class="sub" onclick="addStudent()">
        <br><hr>

        
        <br>

        <label for="studentD"><b>CODE DATE:</b></label>
        <input type="text" id="studentD" class="code" required>

        <label for="studentB"><b>A/C BALANCE :</b></label>
        <input type="number" id="studentB" class="code" required><br><br>

        <label for="studentreg"><b>NAME :</b></label>
        <input type="text" id="studentreg" class="code" required>

        <label for="studentrecipt"><b>VILLAGE :</b></label>
        <input type="text" id="studentrecipt" class="code" required>

        <label for="studentstatus"><b>REG. ID:</b></label>
        <input type="text" id="studentstatus" class="code"><br><br>

        <label for="studentAdhaar"><b>ADHAAR SEEDING :</b></label>
        <input type="text" id="studentAdhaar" class="code" required>

        <label for="studentPan"><b>SMS ALERTS! :</b></label>
<div class="toggle-group">
  
    <select id="studentPan" class="code">
            <option value="ENABLE">Enable</option>
            <option value="DISABLE">Disable</option>
        </select>
  
</div>
    
<br><br>

        <label for="studentform"><b>UPI NO.:</b></label>
        <input type="number" id="studentform" class="code">

    <label for="studentpay"><b>SCHOLARSHIP:</b></label>
    <input type="text" id="studentpay" class="code">
         <br><br>

        <label for="studentTD"><b>SIGNED VALID TILL :</b></label>
        <input type="date" id="studentTD" class="code" required>

        <label for="studentsign"><b>A/C TYPE:</b></label>
        <select id="studentsign" class="code">
        <option value="SB(NON-UPI)">SB(NON-UPI)</option>
            <option value="SB(UPI)">SB(UPI)</option>
            <option value="BSBD">SB TINY(BSBD)</option>
            
        </select><br><br>

        <label for="studenttype"><b>TODAY DATE :</b></label>
        <input type="date" id="studenttype" class="code" required>
        <br><br>
        
        </div>
        
<hr>

<div id="knowyourACd" style="display:none;">
    <!-- knowyourAC-->
    
<center>
    <font color="red">*</font>
    <label for="aadhaarSearch"><font color="red"><b>SEARCH A/C WITH AADHAAR:</b></font></label>
    <input type="text" id="aadhaarSearch" class="pass">
    <input type="button" value="Search Aadhaar" class="sub" onclick="searchByAadhaar()">
</center>
<br><br>
</div>


<div id="transferACM" style="display:none;">
    <!-- knowyourAC-->
    

   <h3> <font color="blue">  <b><center><u>TRANSFER (NEFT/UPI)</center></u></b></font></h3>
   
   <font color="blue"><b>* Money Transfer only from UPI A/C</b></font><br><br>
   
    <label for="transferACfrom"><font color="black"><b>From (A/c No.) :</b></font></label>
<input type="text" id="transferACfrom" class="code" >

    <label for="transferACname"><font color="black"><b>From :</b></font></label>
    <input type="text" id="transferACname" placeholder="From Name" class="code"  readonly/><br><br>
   
     <label for="upiN"><font color="black"><b>UPI NO : </b></font></label>
    <input type="text" id="upiN" placeholder="UPI NUMBER" class="code"  readonly/>
    
     <label for="signN"><font color="black"><b>Signed till :</b></font></label>
    <input type="text" id="signN" placeholder="validity" class="code"  readonly/><BR><br>
    
    <font color="blue"><b>* Money Transfer to UPI, NON-UPI,Any A/C</b></font><br><br>
    
      <label for="transferACto"><font color="black"><b>To (A/c No.) :</b></font></label>
    <input type="text" id="transferACto" class="code">
    
    <label for="transferACtoName"><font color="black"><b>To  :</b></font></label>
    <input type="text" placeholder="To Name" id="transferACtoName" class="code"  readonly/><br><BR>
    
    <label for="transferACbalance"><font color="black"><b> Amount :</b></font></label>
    <input type="number" id="transferACbalance" class="code"><br><br>
    
    <center><input type="button" value="Transfer" class="sub" onclick="transferACMd()">
</center>
<br><br>
</div>


<div id="REGEX" style="display:none;">
    <!-- knowyourAC-->
    <CENTER ><H4><B> EXAM REGISTRATION</B></H4></CENTER>

    <font color="black"></font>
    <label for="regNoreg"><font color="black"><b>Reg./EC No :</b></font></label>
    <input type="text" id="regNoreg" class="code">
    
    
    <label for="account"><font color="black"><b>A/C No:</b></font></label>
    <input type="text" id="account" placeholder="account number" class="code"  /><br><BR>
    
    
    
    <label for="name"><font color="black"><b>Name:</b></font></label>
    <input type="text" id="name" placeholder="Name" class="code" readonly />
    
    <label for="date"><font color="black"><b>Date :</b></font></label>
    <input type="date" id="date" class="code"><br><BR>
    
  
  
    <label for="amount"><font color="black"><b>Fees(Swipe dr)  :</b></font></label>
    <input type="text" placeholder="INR" id="amount" class="code"  /><br><BR>
    
    <H5> <B> *FILL AFTER RESULT....  </B></H5>
    
    <label for="PRICEAMOUNT"><font color="black"><b>Price Amount :</b></font></label>
    <input type="text" placeholder="price" id="PRICEAMOUNT" class="code"  />
    
    <label for="TRXID"><font color="black"><b>TRX ID :</b></font></label>
    <input type="text" placeholder="" id="TRXID" class="code"  /><br>
    
    <label for="RESULT"><font color="black"><b>Result (in M.O.)  :</b></font></label>
    <input type="number" placeholder="" id="RESULT" class="code"  /><br><BR>
    
    <center><input type="button" value="Register" class="sub" onclick="submitreg()">
</center>
<br><br>
</div>









<div id="find" style="display:none;">
          <center>  <u><h4> <font color="blue"> CHECK REGISTRATION STATUS</font></hr></u></center><br><br>
        
    <label for="regNoSearch"><font color="black"><b>Reg./EC No :</b></font></label>
    <input type="text" id="regNoSearch" class="code"><br>
    
    
  <br>  
   
    
    <center><input type="button" value="proceed" class="sub" onclick="findreg()">
</center>
<br><br>



<table id="searchResultTable" border="1" style="display: none; margin-top: 10px; width: 100%;">
  <thead>
    <tr>
      <th>Registration No</th>
      <th>Name</th>
      <th>Account</th>
      <th>Date</th>
      <th>Fees (₹)</th>
      <th>Price(₹) </th>
      <th>TRX ID</th>
      <th>Result (M.M.10)</th>
      <th>Action</th>
      
    </tr>
  </thead>
  <tbody></tbody>
</table>
<BR>

</div>



<div id="Application" style="display:none;">
    <!-- knowyourAC-->
    <CENTER ><u><H4><B> APPLICATION </B></H4></u></CENTER>

    <font color="black"></font>
    <label for="regNoreg1"><font color="black"><b>APPLICATION No :</b></font></label>
    <input type="text" id="regNoreg1" class="code"><br><br>
    
    
    <label for="account1"><font color="black"><b>A/C No:</b></font></label>
    <input type="text" id="account1" placeholder="account number" class="code"  />
    
    
    
    <label for="name1"><font color="black"><b>Name:</b></font></label>
    <input type="text" id="name1" placeholder="Name" class="code" readonly /><br><br>
    
    <label for="date1"><font color="black"><b>Date :</b></font></label>
    <input type="date" id="date1" class="code">
    
  
  
    <label for="amount1"><font color="black"><b>APPLY FOR  :</b></font></label>
    <select id="amount1" class="code">
      <option value="APPLY SIGNED">APPLY SIGNED</option>
            
<option value="APPLY DUPLICATE PASSBOOK">APPLY DUPLICATE PASSBOOK</option>       
          
   <option value="ADHAAR SEEDING">ADHAAR SEEDING</option>

<option value="BLOCK/CLOSE UPI(OAPS)">BLOCK/CLOSE UPI(OAPS)</option>

        <option value="APPLY UPI(OAPS)">APPLY UPI(OAPS)</option>
                  <option value="ENABLE SMS ALERTS">ENABLE SMS ALERTS</option>
        <option value="DISABLE SMS ALERTS">DISABLE SMS ALERTS</option>
        <option value="UPDATE PERSONAL DETAILS">UPDATE PERSONAL DETAILS</option>
           <option value="Account Convert(SB)TO(BSBD)">Account Convert(SB)TO(BSBD)</option>
        
   <option value="Account Convert(BSBD)TO(SB)">Account Convert(BSBD)TO(SB)</option> 
        <option value="CLOSE A/C">CLOSE A/C</option>
        
        </select><br><br>
    
    
    
    <label for="PRICEAMOUNT1"><font color="black"><b>Fees(Swipe dr):</b></font></label>
    <input type="text" placeholder="INR" id="PRICEAMOUNT1" class="code"  />
   
        
        
        
    
    <label for="TRXID1"><font color="black"><b>PAYMENT STATUS :</b></font></label>
    <select id="TRXID1" class="code">
            <option value="Pending">Pending</option>
            <option value="Ok">Ok</option>
            <option value="Declined">Declined</option>
            
        </select>
    
    <label for="RESULT1"><font color="black"><b>STATUS  :</b></font></label>
    <select id="RESULT1" class="code">
            <option value="Pending">Pending</option>
            <option value="Ok">Ok</option>
            <option value="Declined">Declined</option>
            
        </select><br><br>

    
    <center><input type="button" value="APPLY" class="sub" onclick="APL()">
</center>
<br><br><hr>
</div>


<div id="ASTATUS" style="display:none;">
     <center>  <u><h4> <font color="blue"> CHECK APPLICATION STATUS</font></hr></u></center><br><br>
        
        
    <label for="regNoSearch1"><font color="black"><b>APPLICATION NUMBER :</b></font></label>
    <input type="text" id="regNoSearch1" class="code"><br>
    
    
  <br>  
   
    
    <center><input type="button" value="proceed" class="sub" onclick="CHECKSTATUS()">
</center>
<br><br>



<table id="searchResultTable1" border="1" style="display: none; margin-top: 10px; width: 100%;">
  <thead>
    <tr>
      <th>APPLICATION NO</th>
      <th>NAME</th>
      <th>A/C</th>
      <th>DATE</th>
      <th>APPLICATION</th>
      <th>Fees(₹) </th>
      <th>PAYMENT STATUS</th>
      <th>STATUS</th>
      <th>Action</th>
      
    </tr>
  </thead>
  <tbody></tbody>
</table>
<BR><br>

</div>

<div id="statement" style="display:none;">
    <!-- knowyourAC-->
    

   <h3> <font color="blue">  <b><center><u>STATEMENT OF ACCOUNT</center></u></b></font></h3>
   
  
   
    <label for="ac"><font color="black"><b>A/c No.:</b></font></label>
<input type="text" id="ac" class="code" >

    <label for="ACname"><font color="black"><b>Name:</b></font></label>
    <input type="text" id="ACname" placeholder=" A/C holder" class="code" /><br><br>
   
      <label for="fromdate"><font color="black"><b>From Date:</b></font></label>
    <input type="date" id="fromdate" class="code">
    
    <label for="todate"><font color="black"><b>To Date :</b></font></label>
    <input type="date" id="todate" class="code" /><br><BR>
    
    
    <center><input type="button" value="Download Statement" class="sub" onclick="Mystatement()">
</center>
<br><br>
</div>


<div  id="back" style="display:none;">
    <label>Select Background Image:</label>
    <input type="file" id="bgUploader" accept="image/*">
</div>


<div  id="back1" style="display:none;">
    
<h2>Upload Logo Online</h2>
  <img id="logo" src="" alt="Logo will appear here">
  <br>
  <input type="file" id="logoInput" accept="image/*">
</div>




   <center>
            <font color="red">*
            <label for="studentID"><b>ENTER A/C CODE:</b></font></label> 
            <input type="text" id="studentID" class="pass" required> 
        </center>
        <br>

        <center>
            <font color="red">*</font>  
            <label for="password"><font color="red"><b>ENTER PASSWORD:</b></font></label>
            <input type="password" id="password" class="pass" required>
        </center><br><br>

        <center>
            <input type="button" value="Search Data" class="sub" onclick="searchStudent()" onclick="showSpinner()">
            
            <input type="button" value="Save Changes" id="saveButton" class="sub" style="display:none;" onclick="saveEditedStudent()">
            
            
      <input type="button" value="Reset Password" class="sub" onclick="resetPassword()">      
            
            
            
            
        </center>
    </form>
</div>

<br>

<table id="feesTable" border="1">
    <thead>
        <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Date</th>
            <th>Village</th>
            <th>Scholarship</th>
            <th>Signed</th>
            <th>Reg.ID</th>
            <th>UPI NO.</th>
            <th>ADHAAR seeding</th>
            <th>SMS Alerts</th>
            <th>BAL.(INR)</th>
            <th>Last Update</th>
            <th>A/C Type</th>
           
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div id="transactionHistory" style="margin-top:20px;"></div>
<br>

<script>
    
    
    
 function statement() {
    document.getElementById("statement").style.display = "block";
    window.scrollTo(0, document.getElementById("statement").offsetTop);
}

    function statement() {
    const form = document.getElementById("statement");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") 
    {
        window.scrollTo(0, form.offsetTop);
    }
}


   function Mystatement() {
   
   const password = prompt("Enter password to proceed:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }
   
    const code = document.getElementById("ac").value.trim(); // FIXED HERE
    const from = new Date(document.getElementById("fromdate").value);
    const to = new Date(document.getElementById("todate").value);

    if (!code || isNaN(from) || isNaN(to)) {
        alert("Please fill in all fields correctly.");
        return;
    }

    const transactions = JSON.parse(localStorage.getItem("transactions")) || [];

    let filtered = transactions.filter(t => {
        if (t.sender !== code && t.recipient !== code) return false;

        const date = new Date(t.date);
        return date >= from && date <= to;
    });

    let historyDiv = document.getElementById("transactionHistory");

    if (filtered.length === 0) {
        historyDiv.innerHTML = `<h3>No transactions found for selected dates for A/c: <span style="color:blue;">${code}</span></h3>`;
        return;
    }

    filtered.reverse(); // latest first

    let html = `<h3>Filtered Statement for <span style="color:black;">${code}</span>:</h3>
    <h4>From Date : <span style="color:black; background:white">${from} </span>:</h4>
    <h4> To Date : <span style="color:black; background:white">${to} </span>:</h4>
    <table   bgcolor="white"
    border="3" cellpadding="1" cellspacing="0" style="border-collapse:collapse; width:100%;">
        <thead>
            <tr style="background:yellow">
                <th>Transaction ID</th>
                <th>Type</th>
                <th>Amount</th>
                <th>A/C or UPI</th>
                <th>Date</th>
                <th>Available Balance</th>
            </tr>
        </thead><tbody>`;

    filtered.forEach(t => {
        let isSender = t.sender === code;
        let amount = (isSender ? "-" : "+") + "₹" + parseFloat(t.amount).toFixed(2);
        let balance = isSender ? t.senderBalance : t.recipientBalance;
        let type = t.type === "deposit" ? "Deposit" : t.type === "withdraw" ? "Withdraw" : (isSender ? "Debit" : "Credit");
        let color = (isSender && t.type !== "deposit") || t.type === "withdraw" ? "red" : "green";
        let otherParty = isSender ? t.recipient : t.sender;

        html += `<tr>
            <td>${t.transactionId}</td>
            <td> ${type}</td>
            <td> ${amount}</td>
            <td>${otherParty}</td>
            <td>${t.date}</td>
            <td>₹${balance}</td>
        </tr>`;
    });

    html += `</tbody></table>`;
    historyDiv.innerHTML = html;
}

 
function creditInterestToAll() {
    const password = prompt("Enter password to proceed:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    let students = JSON.parse(localStorage.getItem("students")) || [];
    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];

    const interestRate = 0.02; // 2% interest
    const today = new Date();
    const currentMonth = today.getMonth();
    const currentYear = today.getFullYear();
    const todayFormatted = today.toLocaleString();

    let creditedStudents = [];

    students.forEach((student, index) => {
        const alreadyCredited = transactions.some(txn => {
            const txnDate = new Date(txn.date);
            return (
                txn.recipient === student.studentID &&
                txn.type === "Credit Interest" &&
                txnDate.getMonth() === currentMonth &&
                txnDate.getFullYear() === currentYear
            );
        });

        if (alreadyCredited) return;

        let currentBalance = parseFloat(student.studentB || 0);
        let interest = parseFloat((currentBalance * interestRate).toFixed(2));

        if (interest > 0) {
            student.studentB = (currentBalance + interest).toFixed(2);
            students[index] = student;

            transactions.push({
                transactionId: Date.now() + "" + Math.floor(Math.random() * 1000),
                sender: "CREDIT INTEREST",
                recipient: student.studentID,
                amount: interest,
                date: todayFormatted,
                senderBalance: "N/A",
                recipientBalance: student.studentB,
                type: "Credit Interest",
                status: "SUCCESS"
            });

            creditedStudents.push(`${student.studentID} (₹${interest})`);
        }
    });

    localStorage.setItem("students", JSON.stringify(students));
    localStorage.setItem("transactions", JSON.stringify(transactions));

    if (creditedStudents.length > 0) {
        alert("Interest credited to the following A/cs:\n\n" + creditedStudents.join("\n\n"));
    } else {
        alert("No interest credited. Either already credited this month or balance too low.");
    }
}


   
function back() {
    document.getElementById("back").style.display = "block";
    window.scrollTo(0, document.getElementById("back").offsetTop);
}

    function back() {
    const form = document.getElementById("back");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") 
    {
        window.scrollTo(0, form.offsetTop);
    }
}


    // Load background from localStorage on page load
    window.onload = function () 
    {
    
    
        const storedBg = localStorage.getItem("backgroundImage");
        if (storedBg) {
            document.body.style.backgroundImage = `url(${storedBg})`;
        }
    };

    // Upload and store background image in localStorage
    document.getElementById("bgUploader").addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function () {
            const imageData = reader.result;
            localStorage.setItem("backgroundImage", imageData);
            document.body.style.backgroundImage = `url(${imageData})`;
        };
        reader.readAsDataURL(file);
    });
    
    
        
    
function cutSmsAlertChargesForAll() {
   
    const password = prompt("Enter password to proceed:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    const students = JSON.parse(localStorage.getItem("students")) || [];
    const transactions = JSON.parse(localStorage.getItem("transactions")) || [];

    const today = new Date();
    
    let chargedCodes = [];

    students.forEach((student, index) => {
        const balance = parseFloat(student.studentB);
        const hasUpi = student.studentform && student.studentform.trim() !== "";

        // ⛔ Skip if studentsign is "BSBD"
        if (student.studentsign && student.studentsign.trim().toUpperCase() === "BSBD") {
            return;
        }
        
          // ⛔ Skip if studentPan is "DISABLE"
        if (student.studentPan && student.studentPan.trim().toUpperCase() === "DISABLE") {
            return;
        }  
        

        const chargeAmount = 20; // Flat ₹20 charge

       

             {
                // Deduct balance
                student.studentB = (balance - chargeAmount).toFixed(2);
                students[index] = student;

                // Save transaction
                transactions.push({
                    transactionId: Date.now() + "" + Math.floor(Math.random() * 1000),
                    sender: student.studentID,
                    recipient: "SMS BULK CHARGES",
                    amount: chargeAmount,
                    date: today.toLocaleString(),
                    senderBalance: student.studentB,
                    type: "MiniBalAuto"
                });

                chargedCodes.push(`${student.studentID} (₹${chargeAmount})`);
            }
        
    });

    localStorage.setItem("students", JSON.stringify(students));
    localStorage.setItem("transactions", JSON.stringify(transactions));

    if (chargedCodes.length > 0) {
        alert(`Sms Bulk Charge (₹20) deducted from:\n\n${chargedCodes.join('\n')}`);
    } else {
        alert("No Codes charged this month.");
    }

    searchStudent(); // Refresh display
}

 function CHECKSTATUS() {
    const password = prompt("Enter password to Login:");
    const storedPassword = localStorage.getItem("adminPassword");

    if (password !== storedPassword) {
        alert("Incorrect password.");
        return;
    }

    const regNoSearch1 = document.getElementById("regNoSearch1").value.trim();
    if (!regNoSearch1) {
        alert("Please enter Application ID");
        return;
    }

    const registrations = JSON.parse(localStorage.getItem("registrations")) || [];
    const found = registrations.find(r => r.regNoreg1 === regNoSearch1);

    const table = document.getElementById("searchResultTable1");
    const tbody = table.querySelector("tbody");
    tbody.innerHTML = ""; // Clear old rows

    if (found) {
     registrations.forEach((reg, index) => {
    if (reg.regNoreg1 === regNoSearch1) 
    {
        const resultColor = (reg.result1 && reg.result1.toLowerCase() === "pending") ? "red" : "green";
        
        
        const resultColor1 = (reg.trxid1 && reg.trxid1.toLowerCase() === "pending") ? "red" : "green";
        

        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${reg.regNoreg1}</td>
            <td>${reg.name1}</td>
            <td>${reg.account1}</td>
            <td>${reg.date1}</td>
            <td><span style="color:green;">${reg.amount1}</span></td>
            <td>₹${reg.price1 || ""}</td>
            <td><span style="color:${resultColor1};">${reg.trxid1 || ""}</span></td>
            
            <td><span style="color:${resultColor};">${reg.result1 || ""}</span></td>
            <td><button onclick="EDITAPP(${index})">Edit</button></td>
        `;
        tbody.appendChild(row);
    }
});
        table.style.display = "table";
    } else {
        alert("❌ Application Number not found.");
        table.style.display = "none";
    }

    document.getElementById("regNoSearch1").value = "";
}

function EDITAPP(index) {
    const password = prompt("Enter password to Login:");
    const storedPassword = localStorage.getItem("adminPassword");

    if (password !== storedPassword) {
        alert("Incorrect password.");
        return;
    }

    const registrations = JSON.parse(localStorage.getItem("registrations")) || [];
    const reg = registrations[index];

    if (!reg) {
        alert("❌ Record not found.");
        return;
    }

    // Fill form fields
    document.getElementById("regNoreg1").value = reg.regNoreg1;
    document.getElementById("account1").value = reg.account1;
    document.getElementById("name1").value = reg.name1;
    document.getElementById("date1").value = reg.date1;
    document.getElementById("amount1").value = reg.amount1;
    document.getElementById("PRICEAMOUNT1").value = reg.price1;
    document.getElementById("TRXID1").value = reg.trxid1;
    document.getElementById("RESULT1").value = reg.result1;

    document.getElementById("Application").style.display = "block";
    window.scrollTo(0, document.getElementById("Application").offsetTop);
    localStorage.setItem("editIndex1", index);
}

function ASTATUS() {
    document.getElementById("ASTATUS").style.display = "block";
    window.scrollTo(0, document.getElementById("ASTATUS").offsetTop);
}

    function ASTATUS() {
    const form = document.getElementById("ASTATUS");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") 
    {
        window.scrollTo(0, form.offsetTop);
    }
}

document.getElementById("account1").addEventListener("input", function () {
    const account1 = this.value.trim();
    const students = JSON.parse(localStorage.getItem("students")) || [];
    const student = students.find(s => s.studentID === account1);
    document.getElementById("name1").value = student ? student.studentreg1 : "";
});





function APL() {
    const password = prompt("Enter password to APPLY:");
    const storedPassword = localStorage.getItem("adminPassword");

    if (password !== storedPassword) {
        alert("Incorrect password.");
        return;
    }

    const regNoreg1 = document.getElementById("regNoreg1").value.trim();
    const account1 = document.getElementById("account1").value.trim();
    const nameInput = document.getElementById("name1");
    let name1 = nameInput.value.trim();

    const students = JSON.parse(localStorage.getItem("students")) || [];
    const matchedStudent1 = students.find(s => s.studentID === account1);

    if (!matchedStudent1) {
        alert("❌ No student found with this Account number.");
        return;
    }

    // Auto-fill name if missing
    if (!name1) {
        name1 = matchedStudent1.studentreg1 || "";
        nameInput.value = name1;
    }

    const date1 = document.getElementById("date1").value.trim();
    const amount1 = document.getElementById("amount1").value.trim();
    const price1 = document.getElementById("PRICEAMOUNT1").value.trim();
    const trxid1 = document.getElementById("TRXID1").value.trim();
    const result1 = document.getElementById("RESULT1").value.trim();

    if (!regNoreg1) {
        alert("Application Number is required.");
        return;
    }

    const regData = {
        regNoreg1, account1, name1, date1,
        amount1, price1, trxid1, result1
    };

    let registrations = JSON.parse(localStorage.getItem("registrations")) || [];
    const editIndex1 = localStorage.getItem("editIndex1");

    if (editIndex1 === null) {
        const alreadyExists = registrations.some(r => r.regNoreg1 === regNoreg1);
        if (alreadyExists) {
            alert("❌ This Application Number is already applied.");
            return;
        }
        registrations.push(regData);
        alert("✔️ Application Apply successfully!");
    } else {
        registrations[editIndex1] = regData;
        localStorage.removeItem("editIndex1");
        alert("✔️ Application updated successfully!");
    }

    localStorage.setItem("registrations", JSON.stringify(registrations));

    // Clear fields
    ["regNoreg1", "account1", "name1", "date1", "amount1", "PRICEAMOUNT1", "TRXID1", "RESULT1"]
        .forEach(id => document.getElementById(id).value = "");

    document.getElementById("Application").style.display = "none";
}
 
 function Application() {
    document.getElementById("Application").style.display = "block";
    window.scrollTo(0, document.getElementById("Application").offsetTop);
}

    function Application() {
    const form = document.getElementById("Application");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") 
    {
        window.scrollTo(0, form.offsetTop);
    }
}

 
 
 
function cutMiniBalForAll() {
    const password = prompt("Enter password to proceed:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    const students = JSON.parse(localStorage.getItem("students")) || [];
    const transactions = JSON.parse(localStorage.getItem("transactions")) || [];

    const today = new Date();
   
    let chargedCodes = [];

    students.forEach((student, index) => {
        const balance = parseFloat(student.studentB);
        const hasUpi = student.studentform && student.studentform.trim() !== "";

        // ⛔ Skip if studentsign is "BSBD"
        if (student.studentsign && student.studentsign.trim().toUpperCase() === "BSBD") {
            return;
        }

        const balanceLimit = hasUpi ? 500 : 200;

        // Calculate 1.5% charge
        const chargeAmount = parseFloat((balance * 0.26).toFixed(2));

        if (balance < balanceLimit && balance >= chargeAmount && chargeAmount > 0) {
            

            {
                // Deduct balance
                student.studentB = (balance - chargeAmount).toFixed(2);
                students[index] = student;

                // Save transaction
                transactions.push({
                    transactionId: Date.now() + "" + Math.floor(Math.random() * 1000),
                    sender: student.studentID,
                    recipient: "MINI BAL CHARGE",
                    amount: chargeAmount,
                    date: today.toLocaleString(),
                    senderBalance: student.studentB,
                    type: "MiniBalAuto"
                });

                chargedCodes.push(`${student.studentID} (₹${chargeAmount})`);
            }
        }
    });

    localStorage.setItem("students", JSON.stringify(students));
    localStorage.setItem("transactions", JSON.stringify(transactions));

    if (chargedCodes.length > 0) {
        alert(`Mini Balance Charge (1.5%) deducted from:\n\n${chargedCodes.join('\n')}`);
    } else {
        alert("No Codes charged this month.");
    }

    searchStudent(); // Refresh display
}


 function findreg() {
    let password = prompt("Enter password to Login:");
    const storedPassword = localStorage.getItem("adminPassword");

    if (password !== storedPassword) {
        alert("Incorrect password.");
        return;
    }

    const regNoSearch = document.getElementById("regNoSearch").value.trim();
    if (!regNoSearch) {
        alert("Please enter Registration No.");
        return;
    }

    const registrations = JSON.parse(localStorage.getItem("registrations")) || [];
    const found = registrations.find(r => r.regNoreg === regNoSearch);

    const table = document.getElementById("searchResultTable");
    const tbody = table.querySelector("tbody");
    tbody.innerHTML = ""; // Clear previous results

    if (found) {
        registrations.forEach((reg, index) => {
            if (reg.regNoreg === regNoSearch) {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${reg.regNoreg}</td>
                    <td>${reg.name}</td>
                    <td>${reg.account}</td>
                    <td>${reg.date}</td>
                    <td><span style="color:green;">₹${reg.amount}</span></td>
                    <td>₹${reg.price || ""}</td>
                    <td><span style="color:red;">${reg.trxid || ""}</span></td>
                    <td>${reg.result || ""}</td>
                    <td><button onclick="editRegistration(${index})">Edit</button></td>
                `;
                tbody.appendChild(row);
            }
        });
        table.style.display = "table";
    } else {
        alert("❌ Registration not found.");
        table.style.display = "none";
    }

    document.getElementById("regNoSearch").value = "";
}
function editRegistration(index)
 {
 
 let password = prompt("Enter password to Login:");
    const storedPassword = localStorage.getItem("adminPassword");

    if (password !== storedPassword) {
        alert("Incorrect password.");
        return;
    }

 
    const registrations = JSON.parse(localStorage.getItem("registrations")) || [];
    const reg = registrations[index];

    if (!reg) {
        alert("❌ Record not found.");
        return;
    }

    // Fill form with existing data
    document.getElementById("regNoreg").value = reg.regNoreg;
    document.getElementById("account").value = reg.account;
    document.getElementById("name").value = reg.name;
    document.getElementById("date").value = reg.date;
    document.getElementById("amount").value = reg.amount;
    document.getElementById("PRICEAMOUNT").value = reg.price;
    document.getElementById("TRXID").value = reg.trxid;
    document.getElementById("RESULT").value = reg.result;

    // Show the registration form
    document.getElementById("REGEX").style.display = "block";
    window.scrollTo(0, document.getElementById("REGEX").offsetTop);

    // Save index for editing
    localStorage.setItem("editIndex", index);
}


function find() {
    document.getElementById("find").style.display = "block";
    window.scrollTo(0, document.getElementById("find").offsetTop);
}

    function find() {
    const form = document.getElementById("find");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") 
    {
        window.scrollTo(0, form.offsetTop);
    }
}

document.getElementById("account").addEventListener("input", function () {
    const account = this.value.trim();
    const students = JSON.parse(localStorage.getItem("students")) || [];
    const student = students.find(s => s.studentID === account);
    document.getElementById("name").value = student ? student.studentreg : "";
});




function submitreg() {
    const password = prompt("Enter password to Register:");
    const storedPassword = localStorage.getItem("adminPassword");

    if (password !== storedPassword) {
        alert("Incorrect password.");
        return;
    }

    const regNoreg = document.getElementById("regNoreg").value.trim();
    const account = document.getElementById("account").value.trim();
    let nameInput = document.getElementById("name");
    let name = nameInput.value.trim();

    const students = JSON.parse(localStorage.getItem("students")) || [];
    const matchedStudent = students.find(s => s.studentID === account);

    if (!matchedStudent) {
        alert("❌ No student found with this Account number.");
        return;
    }

    // Auto-fill name if empty
    if (!name) {
        name = matchedStudent.studentreg;
        nameInput.value = name;
    }

    // ✅ Check if student's signed date is valid
    let today = new Date();
    let signedTill = new Date(matchedStudent.studentTD);  // ✅ FIXED: Get from matched student
    if (today > signedTill) {
        alert("Registration blocked! A/C signed expired. Apply Signed for Registration. ❌");
        return;
    }

    // Collect remaining fields
    const date = document.getElementById("date").value.trim();
    const amount = document.getElementById("amount").value.trim();
    const price = document.getElementById("PRICEAMOUNT").value.trim();
    const trxid = document.getElementById("TRXID").value.trim();
    const result = document.getElementById("RESULT").value.trim();

    if (!regNoreg) {
        alert("Registration Number is required.");
        return;
    }

    const regData = {
        regNoreg,
        account,
        name,
        date,
        amount,
        price,
        trxid,
        result
    };

    let registrations = JSON.parse(localStorage.getItem("registrations")) || [];
    const editIndex = localStorage.getItem("editIndex");

    if (editIndex === null) {
        const alreadyExists = registrations.some(r => r.regNoreg === regNoreg);
        if (alreadyExists) {
            alert("❌ This Registration Number is already registered.");
            return;
        }
    }

    if (editIndex !== null) {
        registrations[editIndex] = regData;
        localStorage.removeItem("editIndex");
        alert("✔️ Registration updated successfully!");
    } else {
        registrations.push(regData);
        alert("✔️ Registration saved successfully!");
    }

    localStorage.setItem("registrations", JSON.stringify(registrations));

    const fieldIds = [
        "regNoreg", "account", "name", "date",
        "amount", "PRICEAMOUNT", "TRXID", "RESULT",
        "studentID", "password"
    ];
    fieldIds.forEach(id => {
        const input = document.getElementById(id);
        if (input) input.value = "";
    });

    document.getElementById("REGEX").style.display = "none";
}



function REGEX() {
    document.getElementById("REGEX").style.display = "block";
    window.scrollTo(0, document.getElementById("REGEX").offsetTop);
}

    function REGEX() {
    const form = document.getElementById("REGEX");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") 
    {
        window.scrollTo(0, form.offsetTop);
    }
}

function transferACMd() {
    let password = prompt("Enter password to transfer money:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    let fromAC = document.getElementById("transferACfrom").value.trim();
    let fromName = document.getElementById("transferACname").value.trim();
 
 
 let upiN = document.getElementById("upiN").value.trim();
 
 let signN = document.getElementById("signN").value.trim();
 
    let toAC = document.getElementById("transferACto").value.trim();
    let toName = document.getElementById("transferACtoName").value.trim();
    let amount = parseFloat(document.getElementById("transferACbalance").value.trim());

    if (!fromAC || !fromName || !toAC || !upiN || !signN || !toName || isNaN(amount) || amount <= 0) {
        alert("Please fill all fields with valid data.");
        return;
    }

    let students = JSON.parse(localStorage.getItem("students")) || [];

    let sender = students.find(s => s.studentID === fromAC && s.studentreg === fromName);
    let recipient = students.find(s => s.studentID === toAC);

    if (!sender) {
        alert("Sender account not found or name does not match.❌");
        return;
    }

    if (!recipient) {
        alert("Recipient account not found.❌");
        return;
    }

   
    let today = new Date();
    let signedTill = new Date(sender.studentTD); 
    
    // studentTD = "SIGNED VALID TILL"
    
    if (today > signedTill) {
        alert("Transaction blocked! A/C  signed expired. Apply Signed for Transfer Money. ❌");
        return;
    }

    if (amount > parseFloat(sender.studentB)) {
        alert("Insufficient balance in sender's account.");
        return;
    }

    let transactionId = generateRandomTransactionId(8);

    sender.studentB = (parseFloat(sender.studentB) - amount).toFixed(2);
    recipient.studentB = (parseFloat(recipient.studentB) + amount).toFixed(2);

    localStorage.setItem("students", JSON.stringify(students));

    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
    transactions.push({
        transactionId: transactionId,
        sender: sender.studentID,
        recipient: recipient.studentID,
        amount: amount,
        date: new Date().toLocaleString(),
        senderBalance: sender.studentB,
        type: "NEFT Transfer"
    });
    localStorage.setItem("transactions", JSON.stringify(transactions));

    alert(`₹${amount} transferred successfully from ${sender.studentID} to ${recipient.studentID}!\nTransaction ID: ${transactionId} ✔️`);

    // Clear fields
    ["transferACfrom", "transferACname", "upiN", "signN", "transferACto", "transferACtoName", "transferACbalance"]
        .forEach(id => document.getElementById(id).value = "");

    if (typeof searchStudent === "function") searchStudent(); // Refresh table
}






// Auto-fill FROM (Name, UPI, Signed till)
document.getElementById("transferACfrom").addEventListener("input", function () {
    let fromAC = this.value.trim();
    let students = JSON.parse(localStorage.getItem("students")) || [];
    let student = students.find(s => s.studentID === fromAC);

    document.getElementById("transferACname").value = student ? student.studentreg : "";
    document.getElementById("upiN").value = student ? student.studentform : "";
    document.getElementById("signN").value = student ? student.studentTD : "";
});

// Auto-fill TO (Name)
document.getElementById("transferACto").addEventListener("input", function () {
    let toAC = this.value.trim();
    let students = JSON.parse(localStorage.getItem("students")) || [];
    let student = students.find(s => s.studentID === toAC);

    document.getElementById("transferACtoName").value = student ? student.studentreg : "";
});

// Toggle Transfer Form
function transferACM() {
    const form = document.getElementById("transferACM");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") {
        window.scrollTo(0, form.offsetTop);
    }
}

// Toggle New Student Form
function showNewStudentForm() {
    const form = document.getElementById("newStudentFormContainer");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") {
        window.scrollTo(0, form.offsetTop);
    }
}

// Transaction ID generator
function generateRandomTransactionId(length) {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let result = '';
    for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
}

    
  





function transferACM() {
    document.getElementById("transferACM").style.display = "block";
    window.scrollTo(0, document.getElementById("transferACM").offsetTop);
}

    function transferACM() {
    const form = document.getElementById("transferACM");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") {
        window.scrollTo(0, form.offsetTop);
    }
}

  
    
    function showNewStudentForm() {
    document.getElementById("newStudentFormContainer").style.display = "block";
    window.scrollTo(0, document.getElementById("newStudentFormContainer").offsetTop);
}
    function showNewStudentForm() {
    const form = document.getElementById("newStudentFormContainer");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") {
        window.scrollTo(0, form.offsetTop);
    }
}



function transactionSearchWithId() {
    document.getElementById("transactionSearchWithIdd").style.display = "block";
    window.scrollTo(0, document.getElementById("transactionSearchWithIdd").offsetTop);
}

    function transactionSearchWithId() {
    const form = document.getElementById("transactionSearchWithIdd");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") {
        window.scrollTo(0, form.offsetTop);
    }
}


    
  function knowyourAC() {
    document.getElementById("knowyourACd").style.display = "block";
    window.scrollTo(0, document.getElementById("knowyourACd").offsetTop);
}
    function knowyourAC() {
    const form = document.getElementById("knowyourACd");
    form.style.display = (form.style.display === "none" || form.style.display === "") ? "block" : "none";
    if (form.style.display === "block") {
        window.scrollTo(0, form.offsetTop);
    }
}  
    


function searchByAadhaar() {
    let aadhaar = document.getElementById("aadhaarSearch").value.trim();
    let password = document.getElementById("password").value.trim();

    if (!aadhaar) {
        alert("Enter Aadhaar number.");
        return;
    }

    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }



    
    let students = JSON.parse(localStorage.getItem("students")) || [];
    let tableBody = document.getElementById("feesTable").getElementsByTagName('tbody')[0];
    tableBody.innerHTML = "";

    let found = false;

    students.forEach((student, index) => {
        if (student.studentAdhaar === aadhaar) {
            found = true;
            let row = tableBody.insertRow();
            Object.entries(student).forEach(([key, value]) => {
                let cell = row.insertCell();
                if (key === "studentB") {
                    cell.innerHTML = `<span style="color:green;">₹${value}</span>`;
                } else if (key === "studentTD") {
                    cell.innerHTML = `<span style="color:red;">${value}</span>`;
                } else if (key === "studentAdhaar") {
                    cell.innerHTML = `<span style="color:green;">${value}</span>`;
                } else {
                    cell.textContent = value;
                }
            });
            let actionsCell = row.insertCell();
            actionsCell.innerHTML = `
                
                <button onclick="transferToAdhaar(${index})">Aadhaar Transfer</button>`;
        }
    });

    if (!found) {
        alert("Aadhaar number not link in A/C. ❌");
    }

    // Clear Aadhaar and password fields
    document.getElementById("aadhaarSearch").value = "";
    document.getElementById("password").value = "";
}





function toggleMenu() {
    const menu = document.getElementById("menuOptions");
    menu.style.display = menu.style.display === "block" ? "none" : "block";
}

// Optional: Close menu when clicking outside
document.addEventListener("click", function (event) {
    const menu = document.getElementById("menuOptions");
    const dots = document.querySelector(".dots");
    if (!menu.contains(event.target) && !dots.contains(event.target)) {
        menu.style.display = "none";
    }
});





// Initial Setup
if (!localStorage.getItem("adminPassword")) {
    localStorage.setItem("adminPassword", "Q02");
}

let editIndex = null; // Declare this globally

// Add Student
function addStudent() {
    let password = document.getElementById("password").value.trim();
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    let students = JSON.parse(localStorage.getItem("students")) || [];

    let newStudentID = document.getElementById("studentID").value.trim();
    let newStudentReg = document.getElementById("studentreg").value.trim();
    
    let newStudentAdhaar = document.getElementById("studentAdhaar").value.trim();
  
  
  // ✅ Check for duplicate Adhaar
    let isDuplicated = students.some(student => student.studentAdhaar === newStudentAdhaar);
    if (isDuplicated) {
        alert("❌ This Aadhaar number is already linked to another Account. This is an Existing customer.");
        return;
    }
  
    

    // ✅ Check for duplicate studentID
    let isDuplicate = students.some(student => student.studentID === newStudentID);
    if (isDuplicate) {
        alert("❌ Student with this Code (ID) already exists.");
        return;
    }

    

    let newStudent = {
        studentID: newStudentID,
        studentreg: newStudentReg,
        studentD: document.getElementById("studentD").value.trim(),
        studentrecipt: document.getElementById("studentrecipt").value.trim(),
        studentpay: document.getElementById("studentpay").value.trim(),
        studentTD: document.getElementById("studentTD").value.trim(),
        studentstatus: document.getElementById("studentstatus").value.trim(),
        studentform: document.getElementById("studentform").value.trim(),
        studentAdhaar: document.getElementById("studentAdhaar").value.trim(),
        studentPan: document.getElementById("studentPan").value.trim(),
        studentB: parseFloat(document.getElementById("studentB").value.trim()),
        studenttype: document.getElementById("studenttype").value.trim(),
        studentsign: document.getElementById("studentsign").value.trim(),
        history: []
    };

    students.push(newStudent);
    localStorage.setItem("students", JSON.stringify(students));
    alert("✅ Student data added successfully!");
    document.getElementById("studentForm").reset();
}


// Search Student
function searchStudent() {
    let studentID = document.getElementById("studentID").value.trim();
    let password = document.getElementById("password").value;

    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    let students = JSON.parse(localStorage.getItem("students")) || [];
    let studentIndex = students.findIndex(s => s.studentID === studentID);

    if (studentIndex === -1) {
        alert("Student not found.");
        return;
    }

    let student = students[studentIndex];
    let table = document.getElementById("feesTable");
    let tbody = table.tBodies[0];
    tbody.innerHTML = "";

    // Insert student data row
    let row = tbody.insertRow();
    row.innerHTML = `
        <td>${student.studentID}</td>
        <td>${student.studentreg}</td>
        <td>${student.studentD}</td>
        <td>${student.studentrecipt}</td>
        <td>${student.studentpay}</td>
        <td><span style="color:red;">${student.studentTD}</span></td>
        <td>${student.studentstatus}</td>
        <td>${student.studentform}</td>
        <td><span style="color:green;">${student.studentAdhaar}</span></td>
        <td>${student.studentPan}</td>
        <td><span style="color:green;">₹${student.studentB}</span></td>
        <td>${student.studenttype}</td>
        <td>${student.studentsign}</td>
    `;

    // Insert action buttons row
    let actionRow = tbody.insertRow();
    actionRow.innerHTML = `
        <td colspan="13" style="text-align: center;">
            <button onclick="editStudent(${studentIndex})">Edit</button>
            <button onclick="deleteStudent(${studentIndex})">Close A/C</button>
            <button onclick="transferMoney(${studentIndex})">Transfer</button>
            <button onclick="depositMoney(${studentIndex})">Deposit</button>
            <button onclick="withdrawMoney(${studentIndex})">Withdraw</button>
            <button onclick="swipeMoney(${studentIndex})">Swipe DR</button>
            <button onclick="transferToAdhaar(${studentIndex})">Aadhaar Transfer</button>
            <button onclick="showHistory('${student.studentID}')">Passbook</button>
        </td>
    `;
    
  document.getElementById("studentID").value = "";
    document.getElementById("password").value = "";   
    
}

// Edit Student
function editStudent(index) {
    let password = prompt("Enter password to edit:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    let students = JSON.parse(localStorage.getItem("students")) || [];
    let student = students[index];

    document.getElementById("studentID").value = student.studentID;
    document.getElementById("studentreg").value = student.studentreg;
    document.getElementById("studentD").value = student.studentD;
    document.getElementById("studentrecipt").value = student.studentrecipt;
    document.getElementById("studentpay").value = student.studentpay;
    document.getElementById("studentTD").value = student.studentTD;
    document.getElementById("studentstatus").value = student.studentstatus;
    document.getElementById("studentform").value = student.studentform;
    document.getElementById("studentAdhaar").value = student.studentAdhaar;
    document.getElementById("studentPan").value = student.studentPan;
    document.getElementById("studentB").value = student.studentB;
    document.getElementById("studenttype").value = student.studenttype;
    document.getElementById("studentsign").value = student.studentsign;

    editIndex = index;
    document.getElementById("saveButton").style.display = "inline-block";
}

// Save Edited Student
function saveEditedStudent() {
    let password = document.getElementById("password").value.trim();
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password. Cannot save changes.");
        return;
    }

    let students = JSON.parse(localStorage.getItem("students")) || [];
    let updatedStudent = {
        studentID: document.getElementById("studentID").value.trim(),
        studentreg: document.getElementById("studentreg").value.trim(),
        studentD: document.getElementById("studentD").value.trim(),
        studentrecipt: document.getElementById("studentrecipt").value.trim(),
        studentpay: document.getElementById("studentpay").value.trim(),
        studentTD: document.getElementById("studentTD").value.trim(),
        studentstatus: document.getElementById("studentstatus").value.trim(),
        studentform: document.getElementById("studentform").value.trim(),
        studentAdhaar: document.getElementById("studentAdhaar").value.trim(),
        studentPan: document.getElementById("studentPan").value.trim(),
        studentB: parseFloat(document.getElementById("studentB").value.trim()),
        studenttype: document.getElementById("studenttype").value.trim(),
        studentsign: document.getElementById("studentsign").value.trim()
    };
    
    

   
  
    

    if (editIndex !== null) {
        students[editIndex] = updatedStudent;
        localStorage.setItem("students", JSON.stringify(students));
        alert("Changes saved successfully! ✅");
        document.getElementById("studentForm").reset();
        document.getElementById("saveButton").style.display = "none";
        editIndex = null;
        searchStudent();
    } else {
        alert("No student selected for editing.");
    }
}

// Delete Student
function deleteStudent(index) {
    let password = prompt("Enter password to Close A/C:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }
    
  
    
    
    
    let students = JSON.parse(localStorage.getItem("students")) || [];
    students.splice(index, 1);
    localStorage.setItem("students", JSON.stringify(students));
    alert(" A/c closed successfully. ✅")
}
// Deposit Money
function depositMoney(index) {
    let password = prompt("Enter password to deposit:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    let students = JSON.parse(localStorage.getItem("students")) || [];
    let student = students[index];
    let amount = parseFloat(prompt("Enter amount to deposit:"));

    if (isNaN(amount) || amount <= 0) {
        alert("Invalid amount.");
        return;
    }

    student.studentB = (parseFloat(student.studentB) + amount).toFixed(2);
    localStorage.setItem("students", JSON.stringify(students));

    let checkId = prompt("Enter Check Number:");

    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
    transactions.push({
        transactionId: checkId,
        sender: "CASH",
        recipient: student.studentID,
        amount: amount,
        date: new Date().toLocaleString(),
        recipientBalance: student.studentB,
        type: "deposit"
    });
    localStorage.setItem("transactions", JSON.stringify(transactions));

    alert(`₹${amount} deposited successfully ✅`);
    searchStudent();
}
// Withdraw Money
function withdrawMoney(index) {
    let password = prompt("Enter password to withdraw:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    let students = JSON.parse(localStorage.getItem("students")) || [];
    let student = students[index];

    let today = new Date();
    let signedTill = new Date(student.studentTD); // ✅ FIXED HERE

    // Check account signed validity
    if (today > signedTill) {
        alert("Transaction blocked! A/C signed expired. Apply Signed for Withdraw Money. ❌");
        return;
    }

    let amount = parseFloat(prompt("Enter amount to withdraw:"));
    if (isNaN(amount) || amount <= 0 || amount > parseFloat(student.studentB)) {
        alert("Invalid or insufficient amount.");
        return;
    }

    student.studentB = (parseFloat(student.studentB) - amount).toFixed(2);
    localStorage.setItem("students", JSON.stringify(students));

    let checkId = prompt("Enter Check Number:");

    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
    transactions.push({
        transactionId: checkId,
        sender: student.studentID,
        recipient: "CASH",
        amount: amount,
        date: new Date().toLocaleString(),
        senderBalance: student.studentB,
        type: "withdraw"
    });
    localStorage.setItem("transactions", JSON.stringify(transactions));

    alert(`₹${amount} withdrawn successfully!  ✅`);
    searchStudent();
}

// Swipe DR Money
function swipeMoney(index) {
    let password = prompt("Enter password to Swipe DR:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    let students = JSON.parse(localStorage.getItem("students")) || [];
    let student = students[index];
    let amount = parseFloat(prompt("Enter amount to Swipe DR:"));

    if (isNaN(amount) || amount <= 0 || amount > parseFloat(student.studentB)) {
        alert("Invalid or insufficient amount.");
        return;
    }

    student.studentB = (parseFloat(student.studentB) - amount).toFixed(2);
    localStorage.setItem("students", JSON.stringify(students));

    let checkId = prompt("Enter Draft:");

    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
    transactions.push({
        transactionId: checkId,
        sender: student.studentID,
        recipient: "CHARGES",
        amount: amount,
        date: new Date().toLocaleString(),
        senderBalance: student.studentB,
        type: "Swipe DR"
    });
    localStorage.setItem("transactions", JSON.stringify(transactions));

    alert(`₹${amount} Swipe DR successfully!  ✅`);
    searchStudent();
}



function transferToAdhaar(index) {
    let password = prompt("Enter password for Aadhaar transfer:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }



    let students = JSON.parse(localStorage.getItem("students")) || [];
    let sender = students[index];
    
    
   let today = new Date();
    let signedTill = new Date(sender.studentTD); // ✅ FIXED HERE

    // Check account signed validity
    if (today > signedTill) {
        alert("Transaction blocked! A/C signed expired. Apply Signed for Transfer Money via Adhaar. ❌");
        return;
    }
 
    
    let amount = parseFloat(prompt(`Current Balance: ₹${sender.studentB}\nEnter amount to transfer:`));

    if (isNaN(amount) || amount <= 0) {
        alert("Invalid amount.❌");
        return;
    }

    if (amount > parseFloat(sender.studentB)) {
        alert("Insufficient balance.❌");
        return;
    }

    let recipientAdhaar = prompt("Enter Aadhaar number:");
    let recipient = students.find(s => s.studentAdhaar === recipientAdhaar);

    if (!recipient) {
        alert(" Aadhaar not Linked to a/c❌");
        return;
    }

   
    let transactionId = generateRandomTransactionId(8); 
    
     sender.studentB = (parseFloat(sender.studentB) - amount).toFixed(2);
    recipient.studentB = (parseFloat(recipient.studentB) + amount).toFixed(2);

    localStorage.setItem("students", JSON.stringify(students));

    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
    transactions.push({
        transactionId: transactionId,
        sender: sender.studentID,
        recipient: recipient.studentID,
        amount: amount,
        date: new Date().toLocaleString(),
        senderBalance: sender.studentB,
        recipientBalance: recipient.studentB,
        type: "Aadhaar Transfer"
    });
    localStorage.setItem("transactions", JSON.stringify(transactions));

    alert(`₹${amount} transferred to Adhaar successfully \nTransaction ID: ${transactionId}  ✅`);
    searchStudent();
}

// Show Transaction History

function showHistory(code) {
    let password = prompt("Enter password to view Statement:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
    let historyDiv = document.getElementById("transactionHistory");

    if (!historyDiv) {
        alert("History div not found! Make sure you have <div id='transactionHistory'></div> in your HTML.");
        return;
    }

    let history = transactions.filter(t => t.sender === code || t.recipient === code);

    if (history.length === 0) {
        historyDiv.innerHTML = `<h3>No transaction Statement for Code: <span style="color:blue;">${code}</span></h3>`;
        return;
    }

    // 🔁 Reverse the history to show latest transactions first
    history.reverse();

    let html = `<h3>Passbook  for <span style="color:blue;">${code}</span>:</h3>
    <table border="1" cellpadding="2" cellspacing="0" style="border-collapse:collapse; width:80%;">
        <thead>
            <tr style="background:#f2f2f2;">
                <th>Transaction ID</th>
                <th>Type</th>
                <th>Amount</th>
                <th>A/C or UPI</th>
                <th>Date</th>
                <th>Available Balance</th>
            </tr>
        </thead><tbody>`;

    history.forEach(t => {
        let isSender = t.sender === code;
        let amount = (isSender ? "-" : "+") + "₹" + parseFloat(t.amount).toFixed(2);
        let balance = isSender ? t.senderBalance : t.recipientBalance;
        let type = t.type === "deposit" ? "Deposit" : t.type === "withdraw" ? "Withdraw" : (isSender ? "Debit" : "Credit");
        let color = (isSender && t.type !== "deposit") || t.type === "withdraw" ? "red" : "green";
        let otherParty = isSender ? t.recipient : t.sender;

        html += `<tr>
            <td>${t.transactionId}</td>
            <td style="color:${color};">${type}</td>
            <td style="color:${color};">${amount}</td>
            <td>${otherParty}</td>
            <td>${t.date}</td>
            <td>₹${balance}</td>
        </tr>`;
    });

    html += `</tbody></table>`;

    historyDiv.innerHTML = html;
}


function generateRandomTransactionId(length = 8) {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let result = '';
    for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
}



function transferMoney(index) {
    let password = prompt("Enter password to transfer money:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }
    
  

    

    let students = JSON.parse(localStorage.getItem("students")) || [];
    let sender = students[index];


let today = new Date();
    let signedTill = new Date(sender.studentTD); // ✅ FIXED HERE

    // Check account signed validity
    if (today > signedTill) {
        alert("Transaction blocked! A/C signed expired. Apply Signed for Transfer Money. ❌");
        return;
    }





    let recipientID = prompt("Enter Recipent Code :");
    let recipient = students.find(s => s.studentID === recipientID);

    if (!recipient) {
        alert("Recipient Code not found.");
        return;
    }

    if (recipient.studentID === sender.studentID) {
        alert("Cannot transfer to the same account.");
        return;
    }

    let amount = parseFloat(prompt(`Sender Balance: ₹${sender.studentB}\nEnter amount to transfer:`));
    if (isNaN(amount) || amount <= 0) {
        alert("Invalid amount.");
        return;
    }

    if (amount > parseFloat(sender.studentB)) {
        alert("Insufficient balance.");
        return;
    }

    let transactionId = generateRandomTransactionId(8); // Generate random 8-char ID

    // Update balances
    sender.studentB = (parseFloat(sender.studentB) - amount).toFixed(2);
    recipient.studentB = (parseFloat(recipient.studentB) + amount).toFixed(2);

    localStorage.setItem("students", JSON.stringify(students));

    // Save transaction
    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];
    transactions.push({
        transactionId: transactionId,
        sender: sender.studentID,
        recipient: recipient.studentID,
        amount: amount,
        date: new Date().toLocaleString(),
        senderBalance: sender.studentB,
        recipientBalance: recipient.studentB,
        type: "Transfer"
    });
    localStorage.setItem("transactions", JSON.stringify(transactions));

    alert(`₹${amount} transferred successfully from ${sender.studentID} to ${recipient.studentID}!\nTransaction ID: ${transactionId} ✅`);

 searchStudent();   
}


function searchTransactionById() {
    let password = prompt("Enter password to check Transaction ID:");
    if (password !== localStorage.getItem("adminPassword")) {
        alert("Incorrect password.");
        return;
    }

    let trxId = document.getElementById("searchTransactionId").value.trim().toUpperCase();
    if (!trxId) {
        alert("Enter a Transaction ID.");
        return;
    }

    let transactions = JSON.parse(localStorage.getItem("transactions")) || [];

    // FIXED LINE: Prevent toUpperCase error
    let result = transactions.find(t => t && t.transactionId && t.transactionId.toUpperCase() === trxId);

    let resultDiv = document.getElementById("transactionStatusResult");

    if (!result) {
        resultDiv.innerHTML = `<p style="color:red;">Transaction ID <strong>${trxId}</strong> not found.</p>`;
        return;
    }

    // Determine viewer (assume sender if unknown)
    let viewerCode = result.sender;
    let isSender = result.sender === viewerCode;

    // Determine transaction type
    let type;
    if (result.type === "deposit") {
        type = "Deposit";
    } else if (result.type === "withdraw") {
        type = "Withdraw";
    } else if (result.type === "Aadhaar Transfer") {
        type = isSender ? "Aadhaar Credit" : "Aadhaar Debit";
    } else {
        type = isSender ? "Debit" : "Credit";
    }

    let color = (type === "Debit" || type.includes("Withdraw")) ? "red" : "green";
    let sign = color === "red" ? "-" : "+";
    let amount = sign + "₹" + parseFloat(result.amount).toFixed(2);
    let balance = isSender ? result.senderBalance : result.recipientBalance;
    let otherParty = isSender ? result.recipient : result.sender;

    let html = `<h3>Transaction Details</h3>
        <table border="1" cellpadding="5" cellspacing="0" style="border-collapse:collapse; width:100%;">
        <thead>
            <tr style="background:#f2f2f2;">
                <th>Transaction ID</th>
                <th>Type</th>
                <th>Amount</th>
                <th>From (A/C)</th>
                <th>To (A/C)</th>
                <th>Date</th>
                <th>Balance After</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>${result.transactionId}</td>
                <td style="color:${color};">${type}</td>
                <td style="color:${color};">${amount}</td>
                <td>${result.sender || "-"}</td>
                <td>${result.recipient || "-"}</td>
                <td>${result.date}</td>
                <td>₹${balance}</td>
            </tr>
        </tbody></table>`;

    resultDiv.innerHTML = html;
}




// Reset Password
function resetPassword() {
    let userId = prompt("Enter User ID to reset password:");
    if (userId === "JASK9781") {
        let newPass = prompt("Enter New Password:");
        if (newPass) {
            localStorage.setItem("adminPassword", newPass.trim());
            alert("Password reset successful!");
        }
    } else {
        alert("Wrong User ID.");
    }
}

</script>
  
  
</body>
</html>
